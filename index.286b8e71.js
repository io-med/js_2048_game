const e=new class{emptyCells=[];score=0;gameStatus="idle";constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.INITIAL_STATE=e,this.state=JSON.parse(JSON.stringify(this.INITIAL_STATE))}getScore(){return this.score}getState(){return this.state}getStatus(){return this.gameStatus}start(){this.setEmptyCells(),this.addNumber(),this.addNumber(),this.gameStatus="playing"}restart(){this.score=0,this.emptyCells=[],this.state=JSON.parse(JSON.stringify(this.INITIAL_STATE)),this.gameStatus="idle"}moveLeft(){if("playing"!==this.gameStatus)return;let e=!1,t=this.state.map(t=>{let s=this.mergeLine(t);return s!==t&&(e=!0),s});e&&this.endMove(t)}moveRight(){if("playing"!==this.gameStatus)return;let e=!1,t=this.state.map(t=>{let s=[...t].reverse(),r=this.mergeLine(s);return r!==s&&(e=!0),r.reverse()});e&&this.endMove(t)}moveUp(){if("playing"!==this.gameStatus)return;let e=!1,t=this.rotateMatrixCounterclockwise(this.state).map(t=>{let s=this.mergeLine(t);return s!==t&&(e=!0),s});e&&this.endMove(this.rotateMatrixClockwise(t))}moveDown(){if("playing"!==this.gameStatus)return;let e=!1,t=this.rotateMatrixClockwise(this.state).map(t=>{let s=this.mergeLine(t);return s!==t&&(e=!0),s});e&&this.endMove(this.rotateMatrixCounterclockwise(t))}endMove(e){this.state=e,this.setEmptyCells(),this.addNumber(),0===this.emptyCells.length&&this.checkIfGameOver()}mergeLine(e){let t=e.filter(e=>0!==e),s=0,r=t.reduce((e,t)=>{if(t===e[e.length-1]){let r=2*t;return e.splice(e.length-1,1,r,0),s+=r,2048===r&&(this.gameStatus="win"),e}return[...e,t]},[]).filter(e=>0!==e),i=Array(e.length-r.length).fill(0),a=[...r,...i];return s>0?(this.score+=s,a):a.toString()===e.toString()?e:a}setEmptyCells(){let e=[];this.state.forEach((t,s)=>{t.forEach((t,r)=>{0===t&&e.push([s,r])})}),this.emptyCells=e}addNumber(){let e=this.emptyCells.length;if(0===e)return;let t=Math.floor(Math.random()*e),s=this.emptyCells[t][0],r=this.emptyCells[t][1];this.state[s][r]=Math.floor(10*Math.random())?2:4,this.emptyCells.splice(t,1)}checkIfGameOver(){let e=this.state;for(let t=0;t<e.length;t+=2){let s=e[t];for(let r=0;r<s.length;r++)if(e[t][r]===e[t+1][r])return}for(let t=0;t<e.length;t++){let s=e[t];for(let r=0;r<s.length;r+=2)if(e[t][r]===e[t][r+1])return}this.gameStatus="lose"}rotateMatrixClockwise(e){let t=e.map(()=>[]);return e.forEach((s,r)=>{s.forEach((s,i)=>{t[i][e.length-r-1]=s})}),t}rotateMatrixCounterclockwise(e){let t=e.map(()=>[]);return e.forEach((s,r)=>{s.forEach((s,i)=>{t[e.length-i-1][r]=s})}),t}},t={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},s=document.querySelectorAll(".field-cell "),r=document.querySelector(".game-score"),i=document.querySelector(".button"),a=document.querySelectorAll(".message"),l=document.querySelector(".message-start"),n=document.querySelector(".message-win"),o=document.querySelector(".message-lose"),h=()=>{for(let e of a)e.classList.add("hidden")};function m(){let t=e.state.flat(1);for(let e=0;e<s.length;e++)s[e].innerHTML=t[e]+"",s[e].className=`field-cell field-cell--${t[e]}`;r.innerHTML=e.score}i.addEventListener("click",()=>{if("idle"===e.gameStatus){e.start(),i.className="button restart",i.innerHTML="Restart",l.classList.add("hidden"),m();return}e.restart(),h(),i.className="button start",i.innerHTML="Start",l.classList.remove("hidden"),m()}),document.addEventListener("keydown",({key:s})=>{if("idle"!==e.gameStatus){switch(s){case t.up:e.moveUp();break;case t.down:e.moveDown();break;case t.left:e.moveLeft();break;case t.right:e.moveRight()}"win"===e.gameStatus&&n.classList.remove("hidden"),"lose"===e.gameStatus&&(h(),o.classList.remove("hidden")),m()}});
//# sourceMappingURL=index.286b8e71.js.map
